<html ng-app="myApp">
<head>
    <link rel="shortcut icon" type="image/x-icon" href="https://www.scriptr.io/themes/scriptr/images/favicon.ico">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="//use.fontawesome.com/cb4ba0acea.js"></script>  
  
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/lib/UIComponents/build/ide/css/components.min.css"/>
 
    <script src="//maps.google.com/maps/api/js?key=AIzaSyBcPYghFh_BXz4dDz-TXTHbU2iV3Wbf57I&libraries=drawing,visualization"></script>
    <script src="/lib/UIComponents/build/ide/js/dashboardBuilder_resources.min.js"></script>
    
        
</head> 
  
<script type="text/javascript"> 
   
    
    (function ($) { 
           Handlebars.registerHelper('json', function(context) {
          if(typeof context === "object") {
               console.log("context object", context);
            return JSON.stringify(context);
          } else {
              console.log("context string", context);
            return context;
          }
    });
          var myApp= angular.module("myApp", ['DashboardBuilder']);
          angular.module('myApp').run(cachedTemplates);  

         $.urlParam = function(name){
                    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
                    if (results==null){
                        return null;
                    }else{
                        return results[1] || 0;
                    }
            }

          $.getUrlVars = function() {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for(var i = 0; i < hashes.length; i++)
            {
              hash = hashes[i].split('=');
              vars.push(hash[0]);
              vars[hash[0]] = hash[1];
            }
            return vars;
          }
          
     var pdDecoded = decodeURIComponent($.urlParam("publicdomain"));
     var publicdomain = pdDecoded.substring(pdDecoded.indexOf("//")+2, pdDecoded.length)
     var wssConfig = ["wsClientProvider",function (wsClientProvider) {
   	      wsClientProvider.setBaseUrl("wss://"+ publicdomain); 
          wsClientProvider.setToken($.urlParam("auth_token"));
          wsClientProvider.setPublishChannel("requestChannel");
          wsClientProvider.setSubscribeChannel("responseChannel");
    }];

    var httpsConfig = ["httpClientProvider",function (httpClientProvider) {
        httpClientProvider.setBaseUrl("https://"+ publicdomain);
        httpClientProvider.setToken($.urlParam("auth_token"));
    }]

	 angular.module('myApp').config(wssConfig);
     angular.module('myApp').config(httpsConfig);
     angular.module('myApp').run(function(editableOptions, editableThemes) {
        editableThemes.bs3.buttonsClass = 'btn-md';
        editableThemes.bs3.submitTpl = '<button type="submit" class="btn btn-warning" title="Submit" aria-label="Submit"><span class="glyphicon glyphicon-ok"></span></button>';
        editableOptions.theme = 'bs3'; // bootstrap3 theme. Can be also 'bs2', 'default'
     });
  
    
     angular.module('myApp').config(function($routeProvider){
           $routeProvider
            .when("/", {
            	templateUrl: '/UIComponents/dashboardBuilder/view/dashboardsList.html'
          	})
            .when("/dashboardsList", {
            	templateUrl: '/UIComponents/dashboardBuilder/view/dashboardsList.html'
          	})
            .when("/newDashboard",{
               templateUrl: '/UIComponents/dashboardBuilder/view/dashboard.html'
            })
            .when("/scriptrIdeRef/:scriptrIdeRef*", {
            	templateUrl: '/UIComponents/dashboardBuilder/view/dashboard.html'
          	})
          	.when('/scriptName/:scriptName*', {
              	templateUrl: '/UIComponents/dashboardBuilder/view/dashboard.html',
             	controller:  'dashboardCtrl',
              	controllerAs: "vm"
            })
           .when('/logout', {
              	templateUrl: '/UIComponents/dashboardBuilder/view/logout.html'
            }) 
            .otherwise({redirectTo:'/'})
       })
     
   	  angular.module('myApp').controller('dashboardCtrl', function($scope, httpClient, $sce, $route, $routeParams) {
          var vm = this;
          //vm.user = (atob(document.cookie.split("=")[1]).split(":")[1])
      });
}(jQuery));
  
</script>
  
<!--script src="/UIComponents/dashboardBuilder/javascript/dashboard.js"></script-->
<body ng-controller="dashboardCtrl as vm">
     <ng-view></ng-view>
	 <div ng-include="'/UIComponents/dashboardBuilder/ide/dashboardTemplate_ide.min'"></div>
</body>  
</html>