<html ng-app="myApp">

    <head>
        <link rel="icon" href="data:;base64,iVBORw0KGgo=">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <!-- Optional theme -->
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <!-- font awesome.css -->
        <script src="https://use.fontawesome.com/3d61d6959e.js"></script>
        <link href="//fonts.googleapis.com/css?family=Josefin+Sans|Montserrat" rel="stylesheet">
        <!-- font awesome.css -->
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>	

        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular-cookies.js"></script>
        <script src="//cdn.rawgit.com/gdi2290/angular-websocket/v1.0.9/angular-websocket.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap-tpls.min.js"></script>

        <script src="/UIComponents/httpProvider.js"></script>
        <script src="/UIComponents/wsProvider.js"></script>
        <script src="/UIComponents/config/scriptrTransport.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/ag-grid/18.0.0/ag-grid.js?ignore=notused36"></script>
        <script src="/UIComponents/dashboard/frontend/components/grid/grid_new.js"></script>

        <link rel="stylesheet" href="/UIComponents/dashboard/frontend/components/grid/grid.css">
    </head>

    <body>

        <script>

            var myApp = angular.module('myApp', ["HttpClient", "WsClient", "Grid"]);

            angular.module('myApp').config(wssConfig);
            angular.module('myApp').config(httpsConfig); 
            myApp.controller('testCtrl', function($scope) {
                var vm = this;
                vm.historyColDef = [
                {headerName: "Order Id", field: "key"},  
                {headerName: "Device Id", field: "deliveredBy", hide: true},  
                {headerName: "Date", field: "orderDate"},
                {headerName: "Scheduled Date", field: "deliveryDate"},
                {headerName: "Name", field: "fullName"},
                {headerName: "Address", field: "address"},
                {headerName: "Total", field: "total"},
                {headerName: "Comments", field: "comments"},
                    
                {headerName: "Status", field: "orderStatus", cellRenderer: function (params) {  
                    return vm.statusRenderer(params);
                }},
                    
                {headerName: "Order", editable : false, cellRenderer: function (params) {  
                    return vm.viewOrder(params);
                }},
                    /*
                {headerName: "Track Order", editable : false, cellRenderer: function (params) {  
                    return vm.trackOrder(params);
                }}
                */
                
            ];

            vm.statusRenderer  = function(params){
                if(params.value == "Pending.." || params.value == "Assigned" )
                {
                     return '<div class="ag-cell-inner"><span style="color:red;">Pending.. </span><i class="fa fa-spinner fa-spin fa-1x"></i></div>' 
                }
                else (params.value == "Confirmed" || params.value == "Delivered")
                {
                     return '<div class="ag-cell-inner" style="color:green;font-weight:bold;">'+params.value+'</div>' 
                }

            }

            vm.trackOrder  = function(params){
                if(params.data.orderStatus == "Confirmed" && params.data.deliveredBy){
                     return '<div class="ag-cell-inner"><a href="#/trackOrder/?deviceId='+params.data.deliveredBy.split("-")[1]+'&key='+params.data.key+'">Track Order</a></div>' 
                }else{
                     return '<button tooltip-placement="auto" uib-tooltip="Tracking mode is not available at this moment." class="confirm-order set-dis-pos disabled">Track</button>'
                }

            }

            vm.viewOrder  = function(params)
            {
                if(params.data)
                {
                    return '<div class="ag-cell-inner"><a href="#/viewOrder/?key='+params.data.key+'">View Order</a></div>' 
                }    
            }

            vm.defaultCellRenderer = function(params){
                if(params.value){
                    return '<span class="ag-cell-inner" tooltip-placement="auto" uib-tooltip="'+ params.value +'">'+params.value+'</span>'
                }else{
                    return ''
                }
            }

            vm.onHistoryLoaded = function(data)
            {
                vm.loading = false;
                if(data.documents.length > 0)
                {
                    vm.historyList = true;
                }
                else
                {
                    vm.historyList = false;
                }
                return data;
            }
            });

        </script>
        <div ng-controller="testCtrl as vm" >
            <scriptr-grid
                  columns-definition='vm.historyColDef' 
                  enable-sorting='true'
                  default-cell-renderer="vm.defaultCellRenderer"   
                  api = 'management/api/getUserOrders'
                  api-params='vm.gridParams'   
                  grid-height='calc(100vh - 100px)'
                  pagination="true"
                  enable-col-resize="true"   
                  suppress-filter='true'
                  cell-editable='false'
                  row-height='50'
                  enable-client-side-filter='true'
                  
                  suppress-filter='false'
                  enable-server-side-filter='true' 
                  enable-server-side-sorting='true'
                  row-model-type='infinite'
                  row-model-selection='multiple'
                  pagination-page-size='1'
                  enable-delete-row='false'
                  on-format-data="vm.onHistoryLoaded"
                  transport='https'>
    </scriptr-grid>
            </body>
        </div>
</html>